Plugins for Lenovo CNOS Telemetry
===
Introduction
---
Ganglia plugins for  capacity planning and congestion detection are presented here.

Preparation for running the Ganglia plugins
---
**Server Installation**


Install  Ubuntu latest stable release 16.04 on a server machine.
Download the files and directories in this plugin to the server.

1. Untar the file lenovo-ganglia.tar.gz *(tar zxvf lenovo-ganglia.tar.gz).
 lenovo-ganglia directory is created with ganglia-src, ganglia-conf and apache-conf 
2. cd to ganglia-src
3. sudo bash ./install.sh install
4. Execute the following commands

   sudo gmond 
   
   sudo gmetad  
5. Open a browser and http://ipaddress/ganglia.

**Lenovo Switch Configuration**

Execute the following command on the Lenovo switch
1. G8272#config

Enters into the configuration mode

2. G8272(config)#feature telemetry

Enables telemetry feature on the switch

3. G8272(config)#no feature restApi

Disable rest server on the switch

4. G8272(config)#feature restApi http

Enable rest server in http mode on port 8090

5. G8272(config)#exit

Exit from the configuration mode.

6. Enabling the BST feature in cnos switch 

PUT http://ipaddress:8090/nos/api/cfg/telemetry/bst/feature

Place the following json body as input to the above rest api
{
 "collection-interval": 60, "send-async-reports": 0, "send-snapshot-on-trigger": 1, "trigger-rate-limit": 1, "async-full-report": 0, "trigger-rate-limit-interval": 10, "bst-enable": 1
 }
  

**Running the plugins**
---
1. Download the files and directories in this plugin to the server.
2. Modify the sample conf.py file  according to the swithches and the corresponding interfaces of the switches.

3. edit the following lines in   /usr/local/etc/gmond.conf
cluster {  name = "Lenovo_data_center"  owner = "Lenovo"  latlong = "unspecified"  url = "unspecified" }

4. sudo gmond

5. sudo gmetad

6. Execute the python script collector.py by issuing the command sudo python collector.py

7. Access the ganglia web URL(http://ipaddress/ganglia) to visualize the output. The different ganglia metrics generated by collector,py will be displayed.

8. To stop the ganglia server  issue the following commands
"sudo killall gmond"

"sudo killall gmetad"

